@import "tailwindcss";

/* ─── Font family tokens ─── */
@theme {
  --font-display: 'Instrument Serif', Georgia, serif;
  --font-body: 'DM Sans', system-ui, sans-serif;
}

/* ─── THEMES (CSS custom properties — safe outside layers) ─── */
:root,
[data-theme="summer"] {
  --bg: #EFF5FA;
  --surface: #FFFFFF;
  --surface-hover: #F5F8FB;
  --text: #1A2744;
  --text-secondary: #475569;
  --text-muted: #94A3B8;
  --border: #DAE3ED;
  --accent: #4A8AB8;
  --accent-hover: #3A7AA8;
  --accent-light: rgba(74, 138, 184, 0.10);
  --shadow: rgba(74, 138, 184, 0.14);
  --correct: #16A34A;
  --correct-bg: rgba(22, 163, 74, 0.09);
  --incorrect: #DC2626;
  --incorrect-bg: rgba(220, 38, 38, 0.09);
  --p1: #DBEEF5;
  --p2: #BFD4ED;
  --p3: #F7E5D0;
  --p4: #F7F0E7;
  --map-bg: #D8E8F0;
}

[data-theme="lavender"] {
  --bg: #F0EDFF;
  --surface: #FFFFFF;
  --surface-hover: #F7F5FF;
  --text: #1A2744;
  --text-secondary: #475569;
  --text-muted: #8B8FA0;
  --border: #DDD8F0;
  --accent: #7A6BE6;
  --accent-hover: #6A5BD6;
  --accent-light: rgba(122, 107, 230, 0.10);
  --shadow: rgba(122, 107, 230, 0.14);
  --correct: #16A34A;
  --correct-bg: rgba(22, 163, 74, 0.09);
  --incorrect: #DC2626;
  --incorrect-bg: rgba(220, 38, 38, 0.09);
  --p1: #DBD5FB;
  --p2: #C5BEFA;
  --p3: #B7B9FA;
  --p4: #C3D3FB;
  --map-bg: #D8D0F0;
}

[data-theme="blush"] {
  --bg: #FFF0F7;
  --surface: #FFFFFF;
  --surface-hover: #FFF7FB;
  --text: #2A1A33;
  --text-secondary: #6B5570;
  --text-muted: #A088A8;
  --border: #F0D8E8;
  --accent: #C058A0;
  --accent-hover: #B04890;
  --accent-light: rgba(192, 88, 160, 0.10);
  --shadow: rgba(192, 88, 160, 0.14);
  --correct: #16A34A;
  --correct-bg: rgba(22, 163, 74, 0.09);
  --incorrect: #DC2626;
  --incorrect-bg: rgba(220, 38, 38, 0.09);
  --p1: #F3B7E4;
  --p2: #F0C8F0;
  --p3: #F4C3FB;
  --p4: #EAC0F8;
  --map-bg: #F0D8E8;
}

[data-theme="grape"] {
  --bg: #F5F0FF;
  --surface: #FFFFFF;
  --surface-hover: #FAF7FF;
  --text: #1E1533;
  --text-secondary: #504060;
  --text-muted: #9080A0;
  --border: #E0D5F0;
  --accent: #8A68D8;
  --accent-hover: #7A58C8;
  --accent-light: rgba(138, 104, 216, 0.10);
  --shadow: rgba(138, 104, 216, 0.14);
  --correct: #16A34A;
  --correct-bg: rgba(22, 163, 74, 0.09);
  --incorrect: #DC2626;
  --incorrect-bg: rgba(220, 38, 38, 0.09);
  --p1: #CFACF9;
  --p2: #BCACF8;
  --p3: #E7D4FA;
  --p4: #D8CAFA;
  --map-bg: #E0D0F0;
}

[data-theme="light"] {
  --bg: #F8F9FA;
  --surface: #FFFFFF;
  --surface-hover: #F1F3F5;
  --text: #1A2744;
  --text-secondary: #475569;
  --text-muted: #94A3B8;
  --border: #E2E8F0;
  --accent: #3B82F6;
  --accent-hover: #2563EB;
  --accent-light: rgba(59, 130, 246, 0.10);
  --shadow: rgba(59, 130, 246, 0.12);
  --correct: #16A34A;
  --correct-bg: rgba(22, 163, 74, 0.09);
  --incorrect: #DC2626;
  --incorrect-bg: rgba(220, 38, 38, 0.09);
  --p1: #DBEAFE;
  --p2: #BFDBFE;
  --p3: #C7D2FE;
  --p4: #E0E7FF;
  --map-bg: #D0E0F0;
}

[data-theme="dark"] {
  --bg: #0F1218;
  --surface: #1A1F28;
  --surface-hover: #242A35;
  --text: #ECE8E1;
  --text-secondary: #A0A8B4;
  --text-muted: #6B7484;
  --border: #2A3040;
  --accent: #C8956C;
  --accent-hover: #D4A67D;
  --accent-light: rgba(200, 149, 108, 0.12);
  --shadow: rgba(0, 0, 0, 0.35);
  --correct: #4ADE80;
  --correct-bg: rgba(74, 222, 128, 0.10);
  --incorrect: #F87171;
  --incorrect-bg: rgba(248, 113, 113, 0.10);
  --p1: #3A2A1E;
  --p2: #2A1E18;
  --p3: #261A14;
  --p4: #1E1410;
  --map-bg: #141820;
}

/*
 * ─── Base layer ───
 * CRITICAL: Must be in @layer base so Tailwind utilities (px-4 etc.) can override.
 * Putting resets OUTSIDE a layer in Tailwind v4 nukes all utility padding/margin.
 */
@layer base {
  html {
    scroll-behavior: smooth;
  }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--text);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
    overflow-y: scroll;
    transition: background 0.3s ease, color 0.3s ease;
  }

  h1, h2, h3, h4, h5, h6 {
    font-family: var(--font-display);
    font-weight: 700;
    line-height: 1.2;
  }

  button, input, select, textarea {
    font-family: inherit;
  }

  a {
    text-decoration: none;
  }
}

/* ─── Utility shadows (in utilities layer for proper cascade) ─── */
@layer utilities {
  .shadow-card {
    box-shadow:
      0 1px 2px rgba(0,0,0,0.04),
      0 4px 20px -4px var(--shadow);
  }
  .shadow-elevated {
    box-shadow:
      0 4px 6px -1px rgba(0,0,0,0.06),
      0 12px 40px -8px var(--shadow);
  }
  .shadow-hover {
    box-shadow:
      0 8px 16px -4px rgba(0,0,0,0.08),
      0 24px 60px -12px var(--shadow);
  }
}

/* ─── Scrollbar ─── */
@layer base {
  ::-webkit-scrollbar { width: 5px; height: 5px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
}

/* ─── Animations ─── */
@keyframes pulse-dot {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.5); opacity: 0.5; }
}

@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-12px); }
}

/* ─── Leaflet overrides (use !important, OK outside layers) ─── */
.leaflet-control-zoom {
  border: none !important;
  border-radius: 10px !important;
  overflow: hidden;
  box-shadow: 0 2px 12px var(--shadow) !important;
  margin: 12px !important;
}
.leaflet-control-zoom a {
  background: var(--surface) !important;
  color: var(--text) !important;
  width: 36px !important;
  height: 36px !important;
  line-height: 36px !important;
  font-size: 18px !important;
  border-bottom: 1px solid var(--border) !important;
  transition: background 0.15s !important;
}
.leaflet-control-zoom a:last-child {
  border-bottom: none !important;
}
.leaflet-control-zoom a:hover {
  background: var(--surface-hover) !important;
}
.leaflet-control-attribution {
  background: rgba(255,255,255,0.85) !important;
  color: var(--text-muted) !important;
  font-size: 9px !important;
  border-radius: 6px 0 0 0 !important;
  opacity: 0.8;
  backdrop-filter: blur(8px);
}
.leaflet-control-attribution a {
  color: var(--accent) !important;
}

/* Quiz tooltip */
.quiz-tooltip {
  background: var(--surface) !important;
  border: 1px solid var(--border) !important;
  border-radius: 8px !important;
  padding: 4px 10px !important;
  box-shadow: 0 2px 12px var(--shadow) !important;
  font-family: var(--font-body) !important;
  font-size: 11px !important;
  font-weight: 600 !important;
  color: var(--text) !important;
  white-space: nowrap !important;
}
.quiz-tooltip::before {
  border-top-color: var(--border) !important;
}
.quiz-tooltip::after {
  border-top-color: var(--surface) !important;
}
.leaflet-tooltip-top.quiz-tooltip::before {
  border-top-color: var(--border) !important;
}
